digraph bpf_structures {
    rankdir=TB;
    node [fontname="Courier New", fontsize=10.5];
    edge [fontname="SimHei", fontsize=9];
    graph [nodesep=0.8, ranksep=1.2];
    
    // 结构体节点
    node [shape=plaintext];
    
    // bpf_prog（带注释）
    bpf_prog [label=<<TABLE BORDER="1" CELLBORDER="0" CELLSPACING="0">
        <TR><TD ALIGN="CENTER" COLSPAN="2" BGCOLOR="#B8E6E6"><B>struct bpf_prog</B></TD></TR>
        <TR>
            <TD BORDER="1" ALIGN="LEFT" PORT="len" BGCOLOR="#B8E6E6">u32 len</TD>
            <TD BORDER="0" ALIGN="LEFT" BGCOLOR="white"><FONT COLOR="gray">指令数</FONT></TD>
        </TR>
        <TR>
            <TD BORDER="1" ALIGN="LEFT" PORT="insnsi" BGCOLOR="#B8E6E6">struct bpf_insn insnsi[]</TD>
            <TD BORDER="0" ALIGN="LEFT" BGCOLOR="white"><FONT COLOR="gray">bpf指令</FONT></TD>
        </TR>
    </TABLE>>];
    
    // perf_event
    perf_event [label=<<TABLE BORDER="1" CELLBORDER="0" CELLSPACING="0" BGCOLOR="#FFE6B8">
        <TR><TD ALIGN="CENTER" PORT="title"><B>struct perf_event</B></TD></TR>
        <TR><TD BORDER="1" ALIGN="LEFT" PORT="tp_event">struct trace_event_call *tp_event</TD></TR>
        <TR><TD BORDER="1" ALIGN="LEFT" PORT="hlist_entry">struct hlist_node hlist_entry</TD></TR>
        <TR><TD BORDER="1" ALIGN="LEFT" PORT="prog">struct bpf_prog *prog</TD></TR>
    </TABLE>>];
    
    // trace_event_call
    trace_event_call [label=<<TABLE BORDER="1" CELLBORDER="0" CELLSPACING="0" BGCOLOR="#C8E6C8">
        <TR><TD ALIGN="CENTER" PORT="title"><B>struct trace_event_call</B></TD></TR>
        <TR><TD BORDER="1" ALIGN="LEFT" PORT="perf_events">struct hlist_head __percpu *perf_events</TD></TR>
        <TR><TD BORDER="1" ALIGN="LEFT" PORT="prog_array">struct bpf_prog_array __rcu *prog_array</TD></TR>
    </TABLE>>];
    
    // bpf_prog_array
    bpf_prog_array [label=<<TABLE BORDER="1" CELLBORDER="0" CELLSPACING="0" BGCOLOR="#E6C8C8">
        <TR><TD ALIGN="CENTER" PORT="title"><B>struct bpf_prog_array</B></TD></TR>
        <TR><TD BORDER="1" ALIGN="LEFT" PORT="items">struct bpf_prog_array_item items[]</TD></TR>
        <TR><TD BORDER="1" ALIGN="LEFT" PORT="prog">struct bpf_prog *prog</TD></TR>
    </TABLE>>];
    
    // syscall_metadata
    syscall_metadata [label=<<TABLE BORDER="1" CELLBORDER="0" CELLSPACING="0" BGCOLOR="#E6D8FF">
        <TR><TD ALIGN="CENTER" PORT="title"><B>struct syscall_metadata</B></TD></TR>
        <TR><TD BORDER="1" ALIGN="LEFT" PORT="enter_event">struct trace_event_call *enter_event</TD></TR>
    </TABLE>>];
    
    // 边的连接
    edge [penwidth=1.5];
    
    // tp_event -> struct trace_event_call
    perf_event:tp_event -> trace_event_call:title [color="#2E86AB"];
    
    // enter_event -> struct trace_event_call
    syscall_metadata:enter_event -> trace_event_call:title [color="#06A77D"];
    
    // prog_array -> struct bpf_prog_array
    trace_event_call:prog_array -> bpf_prog_array:title [color="#9B59B6"];
    
    // perf_event.prog -> struct bpf_prog
    perf_event:prog -> bpf_prog [color="#E63946"];
    
    // bpf_prog_array.prog -> struct bpf_prog
    bpf_prog_array:prog -> bpf_prog [color="#E63946"];
    
    // 链表虚线连接（两条单向虚线）
    perf_event:hlist_entry -> trace_event_call:perf_events [
        color="#95A5A6",
        style=dashed
    ];
    
    trace_event_call:perf_events -> perf_event:hlist_entry [
        color="#95A5A6",
        style=dashed
    ];
    
    // 布局
    {rank=same; perf_event; trace_event_call; bpf_prog_array;}
    {rank=min; bpf_prog;}
    {rank=max; syscall_metadata;}
}
