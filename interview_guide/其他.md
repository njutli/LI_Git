### 映像最深的问题：
现象：
```
可能出现的用例ltp dio_truncate，非必现
失败用例
[ 9307.792759] INFO: task dio_truncate:1784076 blocked for more than 120 seconds.
[ 9307.801099] Tainted: G W OE 5.10.0+ #1
[ 9307.807463] "echo 0 > /proc/sys/kernel/hung_task_timeout_secs" disables this message.
[ 9307.816337] task:dio_truncate state:D stack: 0 pid:1784076 ppid:1784075 flags:0x00000200
[ 9307.826010] Call trace:
[ 9307.829545] __switch_to+0x7c/0xbc
[ 9307.834035] __schedule+0x424/0x850
[ 9307.838607] schedule+0x50/0xe0
[ 9307.842830] rwsem_down_write_slowpath+0x3cc/0x6cc
[ 9307.848704] down_write+0x60/0x70
[ 9307.853133] ext4_dio_write_iter+0xac/0x38c [ext4]
[ 9307.859041] ext4_file_write_iter+0x50/0x160 [ext4]
[ 9307.865021] new_sync_write+0xec/0x18c
[ 9307.869879] vfs_write+0x214/0x2ac
[ 9307.874380] ksys_write+0x70/0xfc
[ 9307.878797] __arm64_sys_write+0x24/0x30
[ 9307.883819] el0_svc_common.constprop.0+0x7c/0x1bc
[ 9307.889707] do_el0_svc+0x2c/0x94
[ 9307.894125] el0_svc+0x20/0x30
[ 9307.898287] el0_sync_handler+0xb0/0xb4
[ 9307.903225] el0_sync+0x160/0x180
[ 9307.907664] INFO: task dio_truncate:1784077 blocked for more than 120 seconds.
[ 9307.916017] Tainted: G W OE 5.10.0+ #1
[ 9307.922455] "echo 0 > /proc/sys/kernel/hung_task_timeout_secs" disables this message.
[ 9307.931410] task:dio_truncate state:D stack: 0 pid:1784077 ppid:1784076 flags:0x00000200
[ 9307.941161] Call trace:
[ 9307.944774] __switch_to+0x7c/0xbc
[ 9307.949341] __schedule+0x424/0x850
[ 9307.953983] schedule+0x50/0xe0
[ 9307.958286] rwsem_down_read_slowpath+0x1b0/0x670
[ 9307.964144] down_read+0xa4/0xc0
[ 9307.968562] ext4_dio_read_iter+0x104/0x110 [ext4]
[ 9307.974533] ext4_file_read_iter+0xec/0x170 [ext4]
[ 9307.980493] new_sync_read+0xec/0x184
[ 9307.985325] vfs_read+0x184/0x1e0
[ 9307.989817] ksys_read+0x74/0x100
[ 9307.994308] __arm64_sys_read+0x24/0x30
[ 9307.999316] el0_svc_common.constprop.0+0x7c/0x1bc
[ 9308.005282] do_el0_svc+0x2c/0x94
[ 9308.009776] el0_svc+0x20/0x30
[ 9308.014017] el0_sync_handler+0xb0/0xb4
[ 9308.019033] el0_sync+0x160/0x180
[ 9308.023536] INFO: task dio_truncate:1784078 blocked for more than 121 seconds.
[ 9308.031940] Tainted: G W OE 5.10.0+ #1
[ 9308.038454] "echo 0 > /proc/sys/kernel/hung_task_timeout_secs" disables this message.
[ 9308.047486] task:dio_truncate state:D stack: 0 pid:1784078 ppid:1784076 flags:0x00000200
[ 9308.057331] Call trace:
[ 9308.061038] __switch_to+0x7c/0xbc
[ 9308.065676] __schedule+0x424/0x850
[ 9308.070397] schedule+0x50/0xe0
[ 9308.074759] rwsem_down_read_slowpath+0x1b0/0x670
[ 9308.080657] down_read+0xa4/0xc0
[ 9308.085091] ext4_dio_read_iter+0x104/0x110 [ext4]
[ 9308.091086] ext4_file_read_iter+0xec/0x170 [ext4]
[ 9308.097064] new_sync_read+0xec/0x184
[ 9308.101919] vfs_read+0x184/0x1e0
[ 9308.106434] ksys_read+0x74/0x100
[ 9308.110944] __arm64_sys_read+0x24/0x30
[ 9308.115961] el0_svc_common.constprop.0+0x7c/0x1bc
[ 9308.121929] do_el0_svc+0x2c/0x94
[ 9308.126427] el0_svc+0x20/0x30
[ 9308.130662] el0_sync_handler+0xb0/0xb4
[ 9308.135678] el0_sync+0x160/0x180
```

原因：
```
handoff机制用于防止锁饿死，但在使能乐观自旋时，如下场景handoff机制不能生效：
1、读者1持锁 -- 1个读者持锁
2、读者2进来，走快速路径持锁 -- 2个读者持锁
3、写者1进来，乐观自旋失败，进入队列等待 -- 2个读者持锁，1个写者在队列中等锁
4、读者3/4/5/6...进来，乐观自旋等待 -- 2个读者持锁，1个写者在队列中等锁，多个读者乐观自旋
5、读者1放锁，因为读者2存在，读者数量非0，不会wake等待队列里的进程(wake进程才能使handoff机制生效) -- 1个读者持锁，1个写者在队列中等锁，多个读者乐观自旋
6、读者3检测到owner变化，抢到读锁 -- 2个读者持锁，1个写者在队列中等锁，多个读者乐观自旋
不断有读者进来，4/5/6陷入循环，写者长时间等不到锁
当前用例存在16个读者1个写者并发的情况，可能会触发上述问题场景
```

修复：
```
2f06f702925b512a95b95dca3855549c047eef58
locking/rwsem: Prevent potential lock starvation
在有写者等锁，且读者持有锁的时候，不允许新读者读者进行rwsem_optimistic_spin，新读者需要进入到等待队列，避免写者饿死
```
